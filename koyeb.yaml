services:
  - name: api
    type: web
    dockerfile: Dockerfile
    ports:
      - port: 8000
    env:
      - name: PORT
        value: "8000"
      - name: PYTHONUNBUFFERED
        value: "1"
    healthcheck:
      path: /healthz
      interval: 30
      timeout: 10
    scaling:
      min: 1
      max: 3

  - name: worker
    type: worker
    dockerfile: Dockerfile
    env:
      - name: PYTHONUNBUFFERED
        value: "1"
    command: celery -A agent_service.services.processing_queue.celery_app worker --loglevel=info --concurrency=2 --uid=nobody --gid=nogroup
    scaling:
      min: 1
      max: 2

